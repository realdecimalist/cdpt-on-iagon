<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>cDPT AI Chatbot</title><style>@import url(https://fonts.googleapis.com/css2?family=Anybody:wght@400;700&display=swap);body{font-family:Anybody,sans-serif;background-color:#000;color:#fff;margin:0;padding:0;display:flex;justify-content:center;align-items:flex-start;min-height:100vh;overflow:auto}.container{max-width:1400px;width:100%;padding:20px;background-color:#000;box-shadow:0 0 10px rgba(0,0,0,.5);text-align:center;margin-top:20px}h1{color:#fff}h3{font-weight:400;font-style:italic;color:#fff}.chat-box{max-height:1000px;overflow-y:auto;border:1px solid #333;padding:10px;margin-bottom:20px;background-color:#333;color:#fff}.chat-message{margin-bottom:10px;padding:10px;border-radius:5px;width:fit-content;max-width:100%;word-wrap:break-word;white-space:pre-wrap;position:relative}.chat-message.user{background-color:#777;align-self:flex-end;margin-left:auto;text-align:right}.chat-message.bot{background-color:#555;align-self:flex-start;margin-right:auto;text-align:left}.chat-message code{background-color:#222;padding:5px;border-radius:3px;display:block;white-space:pre;overflow-x:auto}.chat-message pre code{display:block}.input-group{margin-bottom:20px;text-align:left}.input-group label{display:block;margin-bottom:5px;color:#fff}.input-group textarea{width:100%;padding:10px;border:1px solid #333;border-radius:5px;resize:vertical;height:auto;min-height:100px;background-color:#444;color:#fff;overflow:auto}.button{display:inline-flex;align-items:center;justify-content:center;width:auto;padding:10px;background-color:#007bff;color:#fff;border:none;border-radius:5px;cursor:pointer;text-align:center;text-decoration:none}.button img{margin-right:10px}.button:hover{background-color:#0056b3}.hidden{display:none}#logo{max-width:60%;height:auto;margin-bottom:20px;transition:opacity .5s ease-in-out}.typing #logo{animation:pulse 1s infinite alternate}@keyframes pulse{0%{opacity:1}100%{opacity:.5}}.copy-button{position:absolute;top:5px;right:5px;background-color:#007bff;color:#fff;border:none;border-radius:5px;padding:5px;cursor:pointer;text-align:center;text-decoration:none}.copy-button:hover{background-color:#0056b3}.dhs-widget-button{height:56px;width:56px;border-radius:50%;background-color:#0e0f12;display:flex;align-items:center;justify-content:center;cursor:pointer}.dhs-widget-button img{height:100%;width:100%}</style><script src="https://unpkg.com/react@18.2/umd/react.production.min.js" crossorigin></script><script src="https://unpkg.com/react-dom@18.2/umd/react-dom.production.min.js" crossorigin></script><script type="module" src="https://unpkg.com/@dexhunterio/swaps@0.0.102/lib/umd/swaps.umd.js"></script><script defer="defer" src="/static/js/main.885cc01b.js"></script><link href="/static/css/main.368374f2.css" rel="stylesheet"></head><body><div class="container"><img id="logo" src="https://i.ibb.co/rsvpknc/FPS-Logo-Color-only.png" alt="Your Logo"><h1>cDPT</h1><h3>The Only AI Assistant You Will Ever Need For Cardano</h3><button class="button" id="login-button" onclick="loginWithDiscord()"><img src="https://i.ibb.co/89Qrp66/discord-mark-white.png" alt="Discord Logo" width="20" height="20"> Login with Discord</button><div id="chat-container" class="hidden"><div class="chat-box" id="chat-box"></div><div class="input-group"><label for="message">Message</label> <textarea id="message" placeholder="Enter your message here..."></textarea></div><div class="button-group"><button class="button" onclick="confirmClearChat()">Clear Chat</button> <button class="button" onclick="sendMessage()">Send Message</button> <button class="button" onclick='loadPreviousChat("669286a6143a8475482c3e05")'>Load Previous Chat</button> <button class="button" onclick="getCurrentEpochDetails()">Get Current Epoch Details</button> <button class="button" onclick='getMarketPrice("ADA")'>ADA/IAG Price</button></div></div><div id="dexhunter-root"></div></div><script>let clientId,discordId,threadId;const WHITELISTED_USER_IDS=["410954739547766795","780451451100200971","824443775928762368"];async function fetchConfig(){try{const e=await fetch("/config"),t=await e.json();clientId=t.clientId,console.log("Fetched config:",t)}catch(e){console.error("Error fetching config:",e)}}async function loginWithDiscord(){clientId||await fetchConfig();const e=encodeURIComponent("https://fancy-pond-7060.iagon.io"),t=encodeURIComponent("identify applications.entitlements"),o=`https://discord.com/oauth2/authorize?client_id=${clientId}&redirect_uri=${e}&response_type=code&scope=${t}`;console.log("Redirecting to Discord auth URL:",o),window.location.href=o}async function handleCallback(){const e=new URLSearchParams(window.location.search).get("code");if(e){console.log("Authorization Code:",e);const t=await fetch("https://fancy-pond-7060.iagon.io/discord/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})}),o=await t.json();console.log("Token Data:",o);const a=o.access_token;localStorage.setItem("accessToken",a);const n=await fetch("https://discord.com/api/users/@me",{headers:{Authorization:`Bearer ${a}`}}),s=await n.json();if(console.log("User Data:",s),WHITELISTED_USER_IDS.includes(s.id))return discordId=s.id,localStorage.setItem("discordId",discordId),console.log(`User ${s.id} is whitelisted.`),document.getElementById("login-button").classList.add("hidden"),void document.getElementById("chat-container").classList.remove("hidden");const c=await fetch(`https://fancy-pond-7060.iagon.io/discord/entitlements?accessToken=${a}`),d=await c.json();console.log("Entitlements:",d),d&&Array.isArray(d)&&d.length>0?(discordId=d[0].user_id,localStorage.setItem("discordId",discordId),console.log("Saved discordId to localStorage:",discordId)):console.error("No entitlements found or entitlements format is incorrect.");const r=d&&Array.isArray(d)&&d.some((e=>"1255974004552892486"===e.sku_id&&!e.deleted&&(!e.ends_at||new Date(e.ends_at)>new Date)));console.log("Has active subscription:",r),r?(document.getElementById("login-button").classList.add("hidden"),document.getElementById("chat-container").classList.remove("hidden")):(alert("This command requires a premium subscription! Upgrade now to get access to these features!"),window.location.href="https://discord.com/application-directory/1254680166664507413/store")}else{const e=localStorage.getItem("accessToken");if(discordId=localStorage.getItem("discordId"),console.log("Retrieved discordId from localStorage:",discordId),e&&discordId){const t=await fetch(`https://fancy-pond-7060.iagon.io/discord/entitlements?accessToken=${e}`),o=await t.json();o&&Array.isArray(o)&&o.some((e=>"1255974004552892486"===e.sku_id&&!e.deleted&&(!e.ends_at||new Date(e.ends_at)>new Date)))?(document.getElementById("login-button").classList.add("hidden"),document.getElementById("chat-container").classList.remove("hidden")):(alert("This command requires a premium subscription! Upgrade now to get access to these features!"),window.location.href="https://discord.com/application-directory/1254680166664507413/store")}else loginWithDiscord()}}function escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}async function sendMessage(){console.log("Send message button clicked.");let e=document.getElementById("message").value;if(!e)return void console.log("Message is empty, not sending.");e=escapeHtml(e);const t=document.getElementById("chat-box");addMessageToChat("user",e),document.getElementById("message").value="",document.getElementById("message").focus(),console.log("Message field cleared and focused.");const o=document.createElement("div");o.className="chat-message bot",o.textContent="Thinking...",o.id="typingIndicator",t.appendChild(o),t.scrollTop=t.scrollHeight,console.log("Added typing indicator."),document.getElementById("logo").classList.add("typing");try{if(threadId=localStorage.getItem("threadId"),!threadId){const t=await fetch("https://afe2am4o4cexr5ccxicifawnga0aqxqc.lambda-url.us-east-1.on.aws/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e})}),o=await t.json();threadId=o.threadId,localStorage.setItem("threadId",threadId)}const a=await fetch("https://afe2am4o4cexr5ccxicifawnga0aqxqc.lambda-url.us-east-1.on.aws/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,threadId:threadId})}),n=await a.json();if(o&&o.parentNode===t&&(t.removeChild(o),console.log("Removed typing indicator.")),document.getElementById("logo").classList.remove("typing"),a.ok){const e=await fetch("/process-markdown",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({markdownText:n.message})});addMessageToChat("bot",(await e.json()).htmlContent),console.log("Bot response received:",n.message)}else addMessageToChat("bot",`Error: ${n.error}`),console.error("Bot response error:",n.error);const s=Array.from(t.children).map((e=>({sender:e.classList.contains("user")?"user":"bot",text:e.innerHTML})));try{await fetch("/save-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({discordId:discordId,chatHistory:s})}),console.log("Chat history saved for discordId:",discordId)}catch(e){console.error("Failed to save chat history:",e),addMessageToChat("bot","Warning: Failed to save chat history. You can continue chatting, but the conversation will not be saved.")}}catch(e){o&&o.parentNode===t&&(t.removeChild(o),console.log("Removed typing indicator.")),document.getElementById("logo").classList.remove("typing"),addMessageToChat("bot",`Error: ${e.message}`),console.error("Error sending message:",e.message)}}async function loadPreviousChat(e){console.log("Load previous chat button clicked."),console.log("Loading chat history for fileId:",e);try{const t=await fetch(`/load-chat?fileId=${encodeURIComponent(e)}`);if(!t.ok){const e=await t.json();throw console.error("Failed to load chat history:",e),new Error("Failed to load chat history")}const o=await t.json();console.log("Loaded chat history:",o);const a=sortMessagesByTimestamp(o);for(const e of a){const t=await fetch("/process-markdown",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({markdownText:e.text})}),o=await t.json();addMessageToChat(e.sender,o.htmlContent,e.timestamp)}}catch(e){console.error("Error loading chat history:",e),alert("Failed to load chat history")}}function sortMessagesByTimestamp(e){return e.sort(((e,t)=>t.timestamp-e.timestamp))}function addMessageToChat(e,t,o){const a=document.getElementById("chat-box"),n=document.createElement("div");n.className=`chat-message ${e}`,n.setAttribute("data-timestamp",o),n.innerHTML=t,a.appendChild(n);const s=sortMessagesByTimestamp(Array.from(a.children));a.innerHTML="",s.forEach((e=>a.appendChild(e))),a.scrollTop=a.scrollHeight,console.log("Added message to chat:",{sender:e,message:t})}function typeMessage(e,t){let o=0;const a=document.getElementById("chat-box");setTimeout((function n(){o<t.length&&(e.innerHTML=t.substring(0,o+1),o++,a.scrollTop=a.scrollHeight,setTimeout(n,1))}),1),console.log("Started typing effect for message:",t)}function confirmClearChat(){confirm("Are you sure you want to clear the chat? This action cannot be undone and you will not be able to continue the conversation from the previous thread.")&&clearChat()}function clearChat(){console.log("Clear chat button clicked.");document.getElementById("chat-box").innerHTML="",localStorage.removeItem("threadId"),console.log("Chat cleared.")}function copyToClipboard(e){const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),alert("Copied to clipboard"),console.log("Copied to clipboard:",e)}async function getCurrentEpochDetails(){try{const e=document.getElementById("chat-box"),t=document.createElement("div");t.className="chat-message bot",t.textContent="Fetching epoch details...",t.id="typingIndicator",e.appendChild(t),e.scrollTop=e.scrollHeight;const o=await fetch("/get-current-epoch-details");if(!o.ok){const e=await o.json();return console.error("Failed to fetch current epoch details:",e),void addMessageToChat("bot","Failed to fetch current epoch details")}const a=await o.json();addMessageToChat("bot",`Current Epoch Details:\n${JSON.stringify(a,null,2)}`),e.removeChild(t)}catch(e){console.error("Error fetching current epoch details:",e),addMessageToChat("bot","Error fetching current epoch details")}}async function getMarketPrice(e){try{const t=document.getElementById("chat-box"),o=document.createElement("div");o.className="chat-message bot",o.textContent=`Fetching ${e} price...`,o.id="typingIndicator",t.appendChild(o),t.scrollTop=t.scrollHeight;const a=await fetch(`/get-market-price?currency=${e}`);if(!a.ok){const t=await a.json();return console.error(`Failed to fetch ${e} price:`,t),void addMessageToChat("bot",`Failed to fetch ${e} price`)}const n=await a.json();addMessageToChat("bot",`${e} Price: ${n.price}`),t.removeChild(o)}catch(t){console.error(`Error fetching ${e} price:`,t),addMessageToChat("bot",`Error fetching ${e} price`)}}document.getElementById("message").addEventListener("keypress",(function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),sendMessage())})),window.onload=()=>{localStorage.removeItem("discordId"),localStorage.removeItem("accessToken"),handleCallback()}</script><script src="bundle.js"></script></body></html>